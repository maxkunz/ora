<style>
    .oh-card {
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        background: #fff;
        box-shadow: 0 1px 2px rgba(0, 0, 0, .04);
        min-width: 1500px;
    }

    .oh-pill {
        font-size: 12px;
        line-height: 20px;
        padding: 0 8px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        background: #fafafa;
    }

    .oh-pill:hover {
        background: #f3f4f6;
    }

    .oh-scale {
        /* Minor ticks: every 15 min (96 per day). Major ticks: every hour (24 per day). */
        background: linear-gradient(to right, rgba(17, 24, 39, .18) 0, rgba(17, 24, 39, .18) 1px, transparent 1px) 0 0 / calc(100% / 24) 100% repeat-x,
        linear-gradient(to right, rgba(17, 24, 39, .10) 0, rgba(17, 24, 39, .10) 1px, transparent 1px) 0 0 / calc(100% / 96) 100% repeat-x;

    }

    .oh-hour-labels {
        height: 12px;
        position: relative;
    }

    .oh-hour-labels span {
        position: absolute;
        top: -6px; /* show labels above the scale */
        transform: translateX(-50%);
        font-size: 9px;
        color: #6b7280;
    }

    .oh-row {
        display: grid;
        grid-template-columns: 160px 1fr;
    }

    .oh-grid {
        display: grid;
        grid-template-columns: repeat(96, minmax(8px, 1fr));
    }

    .oh-slot {
        height: 32px;
        cursor: crosshair;
        transition: background-color .06s ease;
    }

    .oh-slot--off {
        background: #eef2f7;
    }

    .oh-slot--off:hover {
        background: #e3e9f2;
    }

    .oh-slot--on {
        background: #10b981;
    }

    .oh-slot--on:hover {
        background: #0ea371;
    }

    .oh-daycell {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 6px 12px;
    }

    .oh-dayname {
        font-weight: 600;
    }

    .oh-actions {
        display: flex;
        gap: 6px;
    }
</style>

<div x-data="announcementModule()" class="max-w-full space-y-6 p-6">
    <!-- Gesamte Ansicht in eine Karte packen -->
    <div class="oh-card">
        <!-- Kopf -->
        <div class="flex items-center justify-between p-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold">Ansagen</h2>
            <!-- Header-Aktionen entfernt -->
        </div>

        <!-- Zwei-Spalten Layout innerhalb der Karte -->
        <div class="grid md:grid-cols-4">
            <!-- Liste -->
            <aside class="md:col-span-1 p-4 space-y-2 border-r border-gray-200">
                <template x-for="it in items" :key="it.id">
                    <div
                            class="group w-full text-left px-3 py-2 rounded border relative cursor-pointer"
                            :class="selectedId === it.id
                ? 'bg-blue-50 border-blue-200'
                : 'bg-white border-gray-200'"
                            role="button" tabindex="0"
                            @click="select(it.id)"
                    >
                        <div class="flex items-center justify-between gap-2">
                            <span class="font-medium" x-text="it.title || 'Unbenannt'"></span>

                            <!-- Aktionen nur bei Auswahl -->
                            <div x-show="selectedId === it.id" class="flex gap-2" @click.stop>
                                <!-- Duplizieren: gelb + Hover-Highlight -->
                                <button
                                        class="p-1 rounded hover:bg-amber-50 focus:outline-none focus:ring-2 focus:ring-amber-200 group"
                                        aria-label="Ansage duplizieren"
                                        @click="duplicate(it.id)"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                         stroke-width="1.5" stroke="currentColor"
                                         class="size-4 text-amber-600 group-hover:text-amber-700">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
                                    </svg>
                                </button>

                                <!-- Löschen: rot + Hover-Highlight -->
                                <button
                                        class="p-1 rounded hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-200 group"
                                        aria-label="Ansage löschen"
                                        @click="remove(it.id)"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                         stroke-width="1.5" stroke="currentColor"
                                         class="size-4 text-red-600 group-hover:text-red-700">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="text-xs text-gray-600 truncate" x-text="it.tts_text || ''"></div>
                    </div>
                </template>

                <!-- Add-New Fläche am Ende -->
                <button
                        class="w-full text-left px-3 py-2 rounded border border-dashed bg-gray-50 hover:bg-gray-100 text-gray-600"
                        @click="add()"
                >
                    <div class="flex items-center justify-center h-10">
                        <span class="text-sm font-medium">+ Neue Ansage hinzufügen</span>
                    </div>
                </button>
            </aside>

            <!-- Editor -->
            <section class="md:col-span-3"
                     x-show="current">
                <!-- Stammdaten -->
                <div class="p-4 space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm mb-1">Titel</label>
                            <input type="text"
                                   class="w-full border rounded px-3 py-2"
                                   x-model="current.title">
                        </div>
                        <div class="flex items-end">
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox"
                                       x-model="current.enabled">
                                Aktiv
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm mb-1">TTS-Text</label>
                        <textarea rows="3"
                                  class="w-full border rounded px-3 py-2"
                                  x-model="current.tts_text"
                                  placeholder="Ansagetext für TTS"></textarea>
                    </div>

                    <!-- Gültigkeit -->
                    <div class="grid gap-4 md:grid-cols-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Gültigkeit</label>
                            <select x-model="current.validity.mode"
                                    @change="setValidityMode($event.target.value)"
                                    class="w-full border rounded px-3 py-2">
                                <option value="always">Immer</option>
                                <option value="range">Datumsbereich</option>
                                <option value="from">Gültig ab</option>
                                <option value="on">Einzelnes Datum</option>
                            </select>
                        </div>
                        <template x-if="current.validity.mode === 'from'">
                            <div class="md:col-span-2">
                                <label class="block text-sm mb-1">Gültig ab</label>
                                <input type="date"
                                       x-model="current.validity.from"
                                       class="w-full border rounded px-3 py-2">
                            </div>
                        </template>
                        <template x-if="current.validity.mode === 'range'">
                            <div class="md:col-span-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm mb-1">Von</label>
                                    <input type="date"
                                           x-model="current.validity.from"
                                           class="w-full border rounded px-3 py-2">
                                </div>
                                <div>
                                    <label class="block text-sm mb-1">Bis</label>
                                    <input type="date"
                                           x-model="current.validity.to"
                                           class="w-full border rounded px-3 py-2">
                                </div>
                            </div>
                        </template>
                        <template x-if="current.validity.mode === 'on'">
                            <div class="md:col-span-2">
                                <label class="block text-sm mb-1">Datum</label>
                                <input type="date"
                                       x-model="current.validity.date"
                                       class="w-full border rounded px-3 py-2">
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Zeitraster -->
                <div class="p-4 space-y-2 select-none border-t border-gray-200">
                    <div class="text-xs text-gray-600">
                        Klicken oder ziehen. 15-Minuten Raster.
                    </div>
                    <div class="oh-row">
                        <div class="px-3 py-2 text-xs text-gray-600">Tag</div>
                        <div class="px-3 py-1 oh-scale">
                            <div class="oh-hour-labels">
                                <template x-for="k in 13" :key="k">
                  <span :style="`left:${((k - 1) * 2) / 24 * 100}%`"
                        x-text="String((k - 1) * 2).padStart(2, '0') + ':00'"></span>
                                </template>
                            </div>
                        </div>
                    </div>

                    <template x-for="(row, idx) in days" :key="row.key">
                        <div class="oh-row">
                            <div class="oh-daycell">
                                <span class="oh-dayname" x-text="row.label"></span>
                                <div class="oh-actions">
                                    <button class="oh-pill"
                                            @click="copyFromPrev(idx)"
                                            title="Vom Vortag kopieren">↑
                                    </button>
                                    <button class="oh-pill"
                                            @click="clearDay(row.key)"
                                            title="Leeren">leer
                                    </button>
                                </div>
                            </div>
                            <div class="oh-scale"
                                 @mouseleave="drag.active = false"
                                 @mouseup="endDrag()">
                                <div class="oh-grid">
                                    <template x-for="bi in 96" :key="bi">
                                        <div class="oh-slot"
                                             :class="isOpenSlot(row.key, bi - 1) ? 'oh-slot--on' : 'oh-slot--off'"
                                             @mousedown.prevent="startDrag(row.key, bi - 1)"
                                             @mouseenter.prevent="dragOver(row.key, bi - 1)"
                                             :title="slotLabel(bi - 1)"></div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

            </section>
        </div>
    </div>
</div>